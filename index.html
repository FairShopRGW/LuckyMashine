<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Slots - Risiko Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

        :root {
            --neon-color: #ff00ff;
            --bg-color: #050505;
            --panel-bg: #1a1a1a;
            --risk-color: #ff3333;
            --take-color: #33ff33;
        }

        body {
            background-color: var(--bg-color);
            color: white;
            font-family: 'Orbitron', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        /* --- Container --- */
        .casino-container {
            background: var(--panel-bg);
            padding: 40px;
            border: 2px solid var(--neon-color);
            border-radius: 20px;
            box-shadow: 0 0 20px var(--neon-color), inset 0 0 20px var(--neon-color);
            text-align: center;
            position: relative;
            width: 420px;
            transition: border-color 0.5s, box-shadow 0.5s;
        }

        h1 {
            text-transform: uppercase;
            text-shadow: 0 0 10px var(--neon-color);
            margin: 0 0 20px 0;
            font-size: 2rem;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.1rem;
            text-shadow: 0 0 5px white;
            background: #000;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #333;
        }

        /* --- Slots --- */
        .slot-machine {
            display: flex;
            justify-content: space-between;
            background: black;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #333;
            margin-bottom: 20px;
            height: 120px;
            overflow: hidden;
            position: relative;
        }

        .reel {
            width: 30%;
            background: #222;
            border: 1px solid var(--neon-color);
            border-radius: 5px;
            font-size: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 10px #000;
        }

        /* Animation */
        .spinning span {
            animation: blurText 0.1s infinite;
        }
        @keyframes blurText {
            0% { transform: translateY(-10px); filter: blur(2px); }
            50% { transform: translateY(10px); filter: blur(4px); }
            100% { transform: translateY(-10px); filter: blur(2px); }
        }

        /* --- Buttons --- */
        button {
            background: transparent;
            color: var(--neon-color);
            border: 2px solid var(--neon-color);
            padding: 15px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 0 10px var(--neon-color);
            transition: 0.2s;
            border-radius: 5px;
            margin: 5px;
            min-width: 100px;
        }

        button:hover:not(:disabled) {
            background: var(--neon-color);
            color: black;
            box-shadow: 0 0 30px var(--neon-color);
        }

        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            box-shadow: none;
            border-color: #555;
            color: #555;
        }

        /* --- Risiko Bereich --- */
        .risk-area {
            margin-top: 15px;
            border-top: 1px solid #333;
            padding-top: 15px;
            display: none; /* Standardm√§√üig ausgeblendet */
            animation: pulseRisk 0.5s infinite alternate;
        }

        .risk-card {
            font-size: 4rem;
            margin: 10px 0;
            text-shadow: 0 0 20px white;
        }

        .risk-btn {
            border-color: var(--risk-color);
            color: var(--risk-color);
            box-shadow: 0 0 10px var(--risk-color);
        }
        .risk-btn:hover:not(:disabled) {
            background: var(--risk-color);
            color: white;
            box-shadow: 0 0 20px var(--risk-color);
        }

        .take-btn {
            border-color: var(--take-color);
            color: var(--take-color);
            box-shadow: 0 0 10px var(--take-color);
        }
        .take-btn:hover:not(:disabled) {
            background: var(--take-color);
            color: black;
            box-shadow: 0 0 20px var(--take-color);
        }

        @keyframes pulseRisk {
            from { box-shadow: 0 0 5px var(--risk-color); }
            to { box-shadow: 0 0 20px var(--risk-color); }
        }

        /* --- Overlays --- */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        .hidden { display: none !important; }

        input {
            background: transparent;
            border: 1px solid var(--neon-color);
            color: white;
            padding: 10px;
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2rem;
            box-shadow: 0 0 5px var(--neon-color);
        }

        .settings-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2rem;
            padding: 5px 10px;
            border: none;
            box-shadow: none;
            min-width: auto;
        }
        .settings-btn:hover { background: transparent; color: white; }

        .color-picker { display: flex; gap: 10px; margin-top: 20px; }
        .color-option { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid white; }
        
        #message-area { 
            height: 30px; margin-top: 10px; 
            font-weight: bold; text-shadow: 0 0 5px white; 
        }

    </style>
</head>
<body>

    <div id="login-overlay" class="overlay">
        <h1 style="color: var(--neon-color)">NEON SLOTS</h1>
        <p>Login zum Speichern</p>
        <input type="text" id="username" placeholder="Dein Name">
        <button onclick="login()">Start Game</button>
    </div>

    <div id="settings-overlay" class="overlay hidden">
        <h2>Farbe w√§hlen</h2>
        <div class="color-picker">
            <div class="color-option" style="background: #ff00ff;" onclick="changeColor('#ff00ff')"></div>
            <div class="color-option" style="background: #00ffff;" onclick="changeColor('#00ffff')"></div>
            <div class="color-option" style="background: #00ff00;" onclick="changeColor('#00ff00')"></div>
            <div class="color-option" style="background: #ffcc00;" onclick="changeColor('#ffcc00')"></div>
            <div class="color-option" style="background: #ff0000;" onclick="changeColor('#ff0000')"></div>
        </div>
        <br><button onclick="toggleSettings()">Zur√ºck</button>
    </div>

    <div class="casino-container">
        <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
        <h1>Neon Slots</h1>
        
        <div class="stats">
            <div>Spieler: <span id="player-name" style="color:var(--neon-color)">Gast</span></div>
            <div>Bank: <span id="money">100</span>‚Ç¨</div>
        </div>

        <div class="slot-machine">
            <div class="reel" id="reel1"><span>üçí</span></div>
            <div class="reel" id="reel2"><span>üçã</span></div>
            <div class="reel" id="reel3"><span>üíé</span></div>
        </div>

        <div id="message-area">Einsatz: 10‚Ç¨</div>

        <div class="controls" id="main-controls">
            <button id="spin-btn" onclick="spin()">SPIN</button>
        </div>

        <div class="risk-area" id="risk-controls">
            <div style="font-size: 0.9rem; margin-bottom: 5px;">GEWINN IM RISIKO:</div>
            <div style="font-size: 1.5rem; color: #fff; margin-bottom: 10px;">
                <span id="current-win-amount">0</span>‚Ç¨
            </div>
            
            <div id="card-display" class="risk-card">üÉè</div>

            <div>
                <button class="take-btn" onclick="collectWin()">NEHMEN</button>
                <button class="risk-btn" onclick="gamble()">RISIKO (x2)</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const symbols = ['üçí', 'üçã', 'üçá', 'üíé', '7Ô∏è‚É£', 'üîî'];
        const costPerSpin = 10;
        let money = 100;
        let currentWin = 0; // Geld das gerade im Risiko h√§ngt
        let currentUser = null;
        
        // --- AUDIO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'spin') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.exponentialRampToValueAtTime(50, now + 0.1);
                gainNode.gain.setValueAtTime(0.05, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start(); osc.stop(now + 0.1);
            } else if (type === 'win') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(500, now);
                osc.frequency.linearRampToValueAtTime(1000, now + 0.1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(); osc.stop(now + 0.3);
            } else if (type === 'gamble_win') {
                // Hoher Ton f√ºr verdoppelt
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.linearRampToValueAtTime(1200, now + 0.2);
                gainNode.gain.setValueAtTime(0.2, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(); osc.stop(now + 0.4);
            } else if (type === 'gamble_lose') {
                // Tiefer Crash Ton
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(50, now + 0.4);
                gainNode.gain.setValueAtTime(0.2, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(); osc.stop(now + 0.4);
            } else if (type === 'cash') {
                // M√ºnzger√§usch
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1200, now);
                osc.frequency.exponentialRampToValueAtTime(1800, now + 0.1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(); osc.stop(now + 0.2);
            }
        }

        // --- CORE GAME ---
        function updateUI() {
            document.getElementById('money').innerText = money;
            document.getElementById('current-win-amount').innerText = currentWin;
            
            if(currentUser) {
                localStorage.setItem('neonSlot_' + currentUser, money);
                localStorage.setItem('neonSlotColor_' + currentUser, getComputedStyle(document.documentElement).getPropertyValue('--neon-color'));
            }
        }

        function getRandomSymbol() {
            return symbols[Math.floor(Math.random() * symbols.length)];
        }

        async function spin() {
            if (money < costPerSpin) {
                document.getElementById('message-area').innerText = "Zu wenig Geld!";
                return;
            }

            // UI Reset
            document.getElementById('risk-controls').style.display = 'none';
            document.getElementById('main-controls').style.display = 'flex';
            document.getElementById('message-area').style.color = "white";

            money -= costPerSpin;
            updateUI();
            
            const btn = document.getElementById('spin-btn');
            btn.disabled = true;
            document.getElementById('message-area').innerText = "Walzen drehen...";

            const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
            reels.forEach(r => r.classList.add('spinning'));

            let results = [];
            for (let i = 0; i < 3; i++) {
                await new Promise(r => setTimeout(r, 400 + (i * 200)));
                playSound('spin');
                reels[i].classList.remove('spinning');
                const symbol = getRandomSymbol();
                reels[i].innerHTML = `<span>${symbol}</span>`;
                results.push(symbol);
            }

            checkWin(results);
            btn.disabled = false;
        }

        function checkWin(results) {
            const [r1, r2, r3] = results;
            let winAmount = 0;

            if (r1 === r2 && r2 === r3) {
                // 3 Gleiche
                if (r1 === '7Ô∏è‚É£') winAmount = 200;
                else if (r1 === 'üíé') winAmount = 100;
                else winAmount = 50;
            } else if (r1 === r2 || r2 === r3 || r1 === r3) {
                // 2 Gleiche
                winAmount = 15;
            }

            if (winAmount > 0) {
                currentWin = winAmount;
                document.getElementById('message-area').innerText = `GEWINN: ${winAmount}‚Ç¨ - Risiko?`;
                document.getElementById('message-area').style.color = "#00ff00";
                playSound('win');
                showRiskMode(); // Hier startet der Risiko-Modus
            } else {
                document.getElementById('message-area').innerText = "Nichts gewonnen.";
            }
        }

        // --- RISK MECHANIC ---
        function showRiskMode() {
            document.getElementById('main-controls').style.display = 'none';
            document.getElementById('risk-controls').style.display = 'block';
            document.getElementById('card-display').innerText = "üÉè";
            updateUI();
        }

        function collectWin() {
            money += currentWin;
            currentWin = 0;
            playSound('cash');
            document.getElementById('message-area').innerText = "Gewinn angenommen!";
            endRiskMode();
        }

        function endRiskMode() {
            document.getElementById('risk-controls').style.display = 'none';
            document.getElementById('main-controls').style.display = 'flex';
            updateUI();
        }

        async function gamble() {
            const cardDisplay = document.getElementById('card-display');
            
            // Animation Sim
            cardDisplay.innerText = "üîÑ";
            await new Promise(r => setTimeout(r, 400));

            // 50/50 Chance
            const isWin = Math.random() > 0.5;

            if (isWin) {
                currentWin *= 2;
                cardDisplay.innerText = Math.random() > 0.5 ? "üî¥" : "‚ö´"; // Zuf√§llige Farbe zeigen
                cardDisplay.style.color = "white"; // Reset
                playSound('gamble_win');
                document.getElementById('message-area').innerText = "VERDOPPELT!";
                updateUI();
                // Risiko bleibt offen f√ºr weitere Verdopplung
            } else {
                currentWin = 0;
                cardDisplay.innerText = "‚ùå";
                playSound('gamble_lose');
                document.getElementById('message-area').innerText = "Alles verloren...";
                document.getElementById('message-area').style.color = "red";
                updateUI();
                setTimeout(endRiskMode, 1000); // Kurz warten dann schlie√üen
            }
        }

        // --- SYSTEM ---
        function login() {
            const val = document.getElementById('username').value.trim();
            if (!val) return alert("Name?");
            currentUser = val;
            document.getElementById('player-name').innerText = currentUser;
            document.getElementById('login-overlay').classList.add('hidden');

            const savedMoney = localStorage.getItem('neonSlot_' + currentUser);
            const savedColor = localStorage.getItem('neonSlotColor_' + currentUser);

            if (savedMoney) money = parseInt(savedMoney);
            if (savedColor) changeColor(savedColor);
            updateUI();
        }

        function toggleSettings() {
            document.getElementById('settings-overlay').classList.toggle('hidden');
        }

        function changeColor(c) {
            document.documentElement.style.setProperty('--neon-color', c);
            if(currentUser) localStorage.setItem('neonSlotColor_' + currentUser, c);
        }
    </script>
</body>
</html>
